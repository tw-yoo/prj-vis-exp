<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChartQA 데이터 변환기</title>
    <link rel="stylesheet" href="data-converter.css">
</head>
<body>
<main class="page">
    <header class="page__header">
        <div>
            <p class="eyebrow">ChartQA · 데이터 수집</p>
            <h1>이미지 기반 CSV 생성</h1>
            <p class="lede">
                차트 이미지를 보며 x/y 축 정보를 입력하고, 픽셀 위치로 y 값을 추정해 CSV를 만들고 이미지를 옮깁니다.
                먼저 ChartQA 폴더를 선택한 뒤 차트 타입을 고르고, 단계 안내에 맞춰 값을 입력하세요.
            </p>
        </div>
        <div class="chart-types" id="chartTypeButtons">
            <button type="button" data-chart-type="bar_simple">Bar · Simple</button>
            <button type="button" data-chart-type="bar_stacked">Bar · Stacked</button>
            <button type="button" data-chart-type="bar_multiple">Bar · Multiple</button>
            <button type="button" data-chart-type="line_simple" class="is-primary">Line · Simple</button>
            <button type="button" data-chart-type="line_multiple">Line · Multiple</button>
        </div>
        <div class="dir-picker">
            <button type="button" id="pickRootButton">ChartQA 폴더 선택</button>
            <span id="rootStatus">폴더가 선택되지 않았습니다.</span>
        </div>
    </header>

    <section class="workspace">
        <div class="viewer">
            <div class="viewer__frame">
                <img id="chartImage" alt="차트 이미지" draggable="false">
                <div id="markerLayer" aria-hidden="true"></div>
                <div class="overlay-hint" id="overlayHint">이미지를 선택하면 여기 표시됩니다.</div>
            </div>
            <div class="viewer__meta">
                <button type="button" id="prevImageButton" class="ghost">이전</button>
                <div class="meta__center">
                    <div id="imageName" class="filename">이미지를 불러오세요</div>
                    <div id="imageCounter" class="counter">0 / 0</div>
                </div>
                <button type="button" id="nextImageButton" class="ghost">다음</button>
            </div>
        </div>

        <div class="panel">
            <div class="status-box">
                <div id="currentTask" class="status-box__primary">ChartQA 폴더를 먼저 선택하세요.</div>
                <div id="secondaryStatus" class="status-box__secondary">ChartQA 폴더 선택 후 차트 타입을 고르면 시작할 수 있습니다.</div>
            </div>

            <div class="field-row is-column hidden" id="groupSection">
                <label class="field">
                    <span class="field__label">그룹 컬럼 이름</span>
                    <input type="text" id="groupLabelInput" placeholder="예: Category">
                </label>
                <label class="field is-full">
                    <span class="field__label">그룹 이름 (한 줄에 한 그룹씩)</span>
                    <textarea id="groupNamesInput" rows="3" placeholder="예: Male&#10;Female"></textarea>
                </label>
                <button type="button" id="groupNamesDoneButton" class="secondary">그룹 입력 완료</button>
                <button type="button" id="resetGroupsButton" class="ghost small">그룹 입력 초기화</button>
            </div>

            <div class="field-row label-row is-column">
                <label class="field">
                    <span class="field__label">X축 라벨</span>
                    <input type="text" id="xLabelInput" placeholder="예: Year">
                </label>
                <label class="field">
                    <span class="field__label">Y축 라벨</span>
                    <input type="text" id="yLabelInput" placeholder="예: Population">
                </label>
                <button type="button" id="labelsConfirmButton" class="primary">라벨 저장</button>
                <button type="button" id="resetLabelsButton" class="ghost small">라벨 입력 초기화</button>
            </div>

            <div class="field-row is-column">
                <div class="field is-full">
                    <span class="field__label">X축 입력 방식</span>
                    <div class="segmented" id="xModeSwitch">
                        <label>
                            <input type="radio" name="xMode" value="range" checked>
                            최소~최대 정수 (연속)
                        </label>
                        <label>
                            <input type="radio" name="xMode" value="manual">
                            직접 입력 (한 줄에 하나씩)
                        </label>
                    </div>
                </div>
                <div class="field-row x-range-row">
                    <label class="field">
                        <span class="field__label">X축 최소값 (정수)</span>
                        <input type="number" id="xMinInput" step="1" placeholder="예: 2010">
                    </label>
                    <label class="field">
                        <span class="field__label">X축 최대값 (정수)</span>
                        <input type="number" id="xMaxInput" step="1" placeholder="예: 2020">
                    </label>
                </div>
                <label class="field is-full">
                    <span class="field__label">X축 값 (한 줄에 하나씩)</span>
                    <textarea id="xValuesInput" rows="4" placeholder="예: 2017&#10;2018&#10;2019"></textarea>
                </label>
                <button type="button" id="xValuesDoneButton" class="secondary">X축 값 입력 완료</button>
                <button type="button" id="resetXButton" class="ghost small">X축 입력 초기화</button>
            </div>

            <div class="field-row">
                <label class="field">
                    <span class="field__label">Y축 최소값</span>
                    <input type="number" id="yMinInput" step="any" placeholder="예: 0">
                </label>
                <label class="field">
                    <span class="field__label">Y축 최대값</span>
                    <input type="number" id="yMaxInput" step="any" placeholder="예: 100">
                </label>
                <button type="button" id="yRangeDoneButton" class="secondary">범위값 입력 완료</button>
                <button type="button" id="resetYRangeButton" class="ghost small">Y축 범위 입력 초기화</button>
            </div>

            <div class="callout" id="clickGuide">y축 범위 값 입력을 끝내면 차트 이미지 위를 클릭해 최소/최대 지점을 지정합니다.</div>
            <div class="field-row is-column">
                <div class="field is-full">
                    <span class="field__label">값 저장 정밀도</span>
                    <div class="segmented" id="precisionSwitch">
                        <label>
                            <input type="radio" name="precision" value="0" checked>
                            정수 (0자리)
                        </label>
                        <label>
                            <input type="radio" name="precision" value="1">
                            소수점 1자리
                        </label>
                        <label>
                            <input type="radio" name="precision" value="2">
                            소수점 2자리
                        </label>
                    </div>
                </div>
            </div>
            <div class="field-row is-column">
                <button type="button" id="resetYClicksButton" class="ghost small">Y축 최소/최대 클릭 초기화</button>
            </div>

            <div class="table-card">
                <div class="table-card__header">
                    <div>측정된 데이터</div>
                    <div id="captureProgress" class="muted">0 / 0</div>
                </div>
                <div class="table-card__body">
                    <table>
                        <thead>
                        <tr>
                            <th>#</th>
                            <th>X</th>
                            <th>Y (계산)</th>
                        </tr>
                        </thead>
                        <tbody id="valueRows">
                        <tr class="placeholder">
                            <td colspan="3">데이터를 입력하면 여기에 표시됩니다.</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="actions">
                <div class="left-actions">
                    <button type="button" id="resetButton" class="ghost">입력 초기화</button>
                </div>
                <div class="right-actions">
                    <button type="button" id="saveButton" class="primary" disabled>CSV 저장 및 이미지 이동</button>
                </div>
            </div>
        </div>
    </section>

    <section class="helper">
        <h2>단계 안내 (line_simple)</h2>
        <ol>
            <li>ChartQA 루트 폴더를 선택합니다.</li>
            <li>Line · Simple을 선택해 변환할 이미지를 불러옵니다.</li>
            <li>X/Y 라벨을 입력하고 <strong>라벨 저장</strong>을 누릅니다.</li>
            <li>X축 값을 한 줄에 하나씩 입력한 뒤 <strong>X축 값 입력 완료</strong>를 누릅니다.</li>
            <li>Y축 최소·최대 값 숫자를 적고 <strong>범위값 입력 완료</strong>를 누릅니다.</li>
            <li>차트 이미지에서 Y축 최소 지점 → 최대 지점 순으로 클릭합니다.</li>
            <li>각 X 값 순서대로 차트 위 점을 클릭해 Y 값을 채웁니다.</li>
            <li>모두 입력되면 <strong>CSV 저장 및 이미지 이동</strong> 버튼이 활성화됩니다.</li>
        </ol>
    </section>
</main>

<script type="module" src="data-converter.js"></script>
</body>
</html>
