<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <title>prj-vis-exp</title>

    <script src="https://d3js.org/d3.v6.min.js" defer></script>

    <!-- CodeMirror -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/edit/closebrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/edit/matchbrackets.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega@5/build/vega.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6/build/vega-embed.min.js"></script>

    <!-- Vega/Vega-Lite -->
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>

</head>

<body>
<div id="container">
    <div id="left-panel">
        <div class="row-header">
            <div class="label">Vega-Lite Spec</div>
            <button id="render-chart-button" style="height: 24px;">Render Chart</button>
        </div>
        <div id="vl-error" style="color: red; font-family: sans-serif; font-size: 0.9em;"></div>
        <textarea id="vl-spec" placeholder="Paste Vega-Lite JSON here">
{
  "$schema": "https://vega.github.io/schema/vega-lite/v3.json",
  "description": "Population Census for year 2000, grouped by age and gender",
  "data": {
    "url": "survey/data/csv/bar/grouped/bar_grouped_203_90.csv"
  },
  "mark": "bar",
  "encoding": {
    "column": {
      "field": "Religious",
      "type": "ordinal",
      "spacing": 5
    },
    "y": {
      "aggregate": "sum",
      "field": "Percentage",
      "type": "quantitative",
      "axis": {
        "title": "Population",
        "grid": false
      }
    },
    "x": {
      "field": "Group",
      "type": "nominal",
      "scale": {
        "rangeStep": 12
      },
      "axis": {
        "title": ""
      }
    },
    "color": {
      "field": "Group",
      "type": "nominal",
      "scale": {
        "range": ["#659CCA","#EA98D2"]
      }
    }
  },
  "config": {
    "view": {
      "stroke": "transparent"
    },
    "axis": {
      "domainWidth": 1
    }
  }
}
  </textarea>

        <div class="row-header">
            <div class="label">Question</div>
            <button id="answer-button" style="height: 24px;">Get Answer</button>
        </div>
        <div>
            <textarea id="question" placeholder="Question"></textarea>
        </div>

        <div class="row-header">
            <div class="label">Answer <span id="answer-status" class="status-label"></span></div>
        </div>
        <div>
            <textarea id="explanation" readonly>Baseline Explanation Here</textarea>
        </div>

        <div class="row-header">
            <div class="label">ChartOps Spec <span id="ops-status" class="status-label"></span></div>
            <button id="run-ops-button" style="height: 24px;">Run Operations</button>
        </div>
        <div id="ops-error" style="color: red; font-family: sans-serif; font-size: 0.9em;"></div>
        <textarea id="ops-spec" placeholder="Paste Atomic-Ops JSON here">
{
  "ops": [
    {
      "op": "retrieveValue",
      "field": "Religious",
      "target": "Hindu",
      "group": "Work participation (%)"
    },
    {
      "op": "retrieveValue",
      "field": "Religious",
      "target": "Hindu",
      "group": "Literacy (%)"
    },
    {
      "op": "diff",
      "field": "value",
      "targetA": "ops_0",
      "targetB": "ops_1",
      "aggregate": "ratio",
      "precision": 4
    }
  ],
  "ops2": [
    {
      "op": "retrieveValue",
      "field": "Religious",
      "target": "Muslim",
      "group": "Work participation (%)"
    },
    {
      "op": "retrieveValue",
      "field": "Religious",
      "target": "Muslim",
      "group": "Literacy (%)"
    },
    {
      "op": "diff",
      "field": "value",
      "targetA": "ops2_0",
      "targetB": "ops2_1",
      "aggregate": "ratio",
      "precision": 4
    }
  ],
  "ops3": [
    {
      "op": "retrieveValue",
      "field": "Religious",
      "target": "Sikh",
      "group": "Work participation (%)"
    },
    {
      "op": "retrieveValue",
      "field": "Religious",
      "target": "Sikh",
      "group": "Literacy (%)"
    },
    {
      "op": "diff",
      "field": "value",
      "targetA": "ops3_0",
      "targetB": "ops3_1",
      "aggregate": "ratio",
      "precision": 4
    }
  ],
  "last": [
    {
      "op": "compare",
      "field": "value",
      "targetA": "ops_2",
      "targetB": "ops2_2",
      "which": "max"
    },
    {
      "op": "compare",
      "field": "value",
      "targetA": "last_0",
      "targetB": "ops3_2",
      "which": "max"
    }
  ],
  "text": {
    "ops": "For the Hindu group, retrieve the Work participation percentage of 40.40 and the Literacy percentage of 65.10, then compute their ratio of 0.6206.",
    "ops2": "For the Muslim group, retrieve the Work participation percentage of 31.30 and the Literacy percentage of 59.10, then compute their ratio of 0.5296.",
    "ops3": "For the Sikh group, retrieve the Work participation percentage of 37.70 and the Literacy percentage of 69.40, then compute their ratio of 0.5432.",
    "last": "Compare the calculated ratios for Hindu (0.6206), Muslim (0.5296), and Sikh (0.5432) to find the maximum, which is Hindu."
  }
}
  </textarea>
    </div>
    <div></div>
    <div id="right-panel">
        <div id="chart"></div>
        <div id="ops-info-box" style="margin-top: 10px; color: #c00; font-family: sans-serif; font-size: 2em;"></div>
    </div>
</div>

<script type="module" src="index.js"></script>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.vlEditor = CodeMirror.fromTextArea(document.getElementById("vl-spec"), {
            mode: { name: "javascript", json: true },
            lineNumbers: true,
            autoCloseBrackets: true,
            matchBrackets: true,
            indentUnit: 2,
            lineWrapping: true
        });
        window.questionEditor = CodeMirror.fromTextArea(document.getElementById("question"), {
            mode: { name: "javascript", json: false },
            lineNumbers: true,
            autoCloseBrackets: true,
            matchBrackets: true,
            indentUnit: 2,
            lineWrapping: true
        });
        window.opsEditor = CodeMirror.fromTextArea(document.getElementById("ops-spec"), {
            mode: { name: "javascript", json: true },
            lineNumbers: true,
            autoCloseBrackets: true,
            matchBrackets: true,
            indentUnit: 2,
            lineWrapping: true
        });
    });
</script>
</body>

</html>
